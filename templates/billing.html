{% extends 'layout.html' %}
{% block content %}

    <section class="billing-section">
<form id="billingForm" method="post" action="{{url_for('billing')}}">
    <label for="productSelect"> Select Product:</label>
    <select id="productSelect" name="productSelect">
        {% for item in inventory %}
            <option value="{{ item.product_rate }}">{{ item.product_name }}</option>
        {% endfor %}
    </select>

    <label for="quantityInput">Quantity:</label>
    <input type="number" id="quantityInput" name="quantityInput" value="1" min="1" />

    <button class="button" type="button" onclick="addProduct()">Add Product</button>
    <h2>Selected Products:</h2>
<label>
    <textarea id="selectedProducts" name="selectedProducts" readonly></textarea>
</label>
    <h3 id="totalAmount">Total Amount:₹0</h3>

    <label>Payment Method:</label>
    <label for="onlinePayment"><input type="radio" name="paymentMethod" value="online" id="onlinePayment" required>Online</label>
    <label for="offlinePayment"><input type="radio" name="paymentMethod" value="offline" id="offlinePayment" required>Offline</label>
    <button type="button" onclick="calculateTotal()">Calculate Total</button>
        {{ form.hidden_tag() }}  <!-- Include the CSRF token -->
        <div>
            {{ form.submit(class="blue-button") }}  <!-- Apply the blue-button class to the submit button -->
        </div>

</form>
    </section>
<div>
{% with messages = get_flashed_messages() %}
        {% if messages %}
            <ul class="flash-messages">
                {% for message in messages %}
                    <li class="info">{{ message }}</li>
                {% endfor %}
            </ul>
        {% endif %}
    {% endwith %}
</div>
    <script>
    let selectedProducts = [];

    function addProduct() {
        const productSelect = document.getElementById('productSelect');
        const quantityInput = document.getElementById('quantityInput');
        const selectedProductsTextarea = document.getElementById('selectedProducts');

        const productId = productSelect.value;
        const productName = productSelect.options[productSelect.selectedIndex].text;
        const quantity = parseInt(quantityInput.value);

        if (productId !== '0' && quantity > 0) {
            const totalPrice = parseInt(productId) * quantity;

            const listItem = `${productName} x ${quantity} - ₹${totalPrice}\n`;
            selectedProductsTextarea.value += listItem;

            selectedProducts.push(totalPrice);

            // Reset product and quantity fields
            productSelect.value = '0';
            quantityInput.value = '1';
        } else {
            alert('Please select a product and enter a valid quantity.');
        }
    }

    function calculateTotal() {
        const totalAmountElement = document.getElementById('totalAmount');
        const totalAmount = selectedProducts.reduce((acc, val) => acc + val, 0);
        totalAmountElement.textContent = `₹${totalAmount}`;
    }
</script>
{% endblock %}